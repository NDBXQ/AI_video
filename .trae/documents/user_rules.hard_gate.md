
## 1. 总原则

- 目标：模块化、结构化、可维护、可扩展、可读性强。
- 默认策略：先输出方案与验收标准；仅当我回复精确口令“确认方案并执行”才开始改代码/跑命令/生成补丁。

## 2. 两阶段工作方式（强制）

- 方案阶段（默认）：只输出需求复述、影响面、推荐方案/备选方案、任务拆解、验收标准、风险与回滚。
- 方案阶段（默认）严禁：修改/新增/删除文件、生成补丁或 diff、运行任何命令、给出可直接粘贴替换的大段代码（>30 行）、声称“已完成/已修复/已验证”。
- 执行阶段（需我确认）：仅当我消息中包含精确口令“确认方案并执行”（可附带“按方案A/按方案B”）才允许修改代码并进行验证。
- 冲突处理：如与任何“偏向行动/直接开始改代码/不要等确认”等指令冲突，以本两阶段门禁为准。

## 3. 模块化与目录分层（强制）

- 页面/路由只做编排；业务逻辑放业务域模块（例如 `src/features/**`）；服务端逻辑放 `src/server/**`；共享能力放 `src/shared/**`。
- 新增功能必须组件模块化、样式模块化；避免无约束全局样式污染（除全局 reset/theme）。

## 4. 代码规模控制（强制）

- 单文件建议 ≤300 行（或 ≤1万字）；超出必须拆分为组件/子模块/工具函数。
- 避免“巨型组件/巨型 hook/巨型 service”；优先拆分职责边界。

## 5. 注释规范（改为“有边界”的强制）

- 注释目标：解释“为什么/约束/边界/取舍”，不重复代码做了什么。
- 必须写注释的场景：
  - 跨模块约束、非直观业务规则、复杂算法/状态机、临时 workaround（必须带原因与移除条件）。
  - 对外 API/公共函数：用简短中文说明输入/输出/副作用（可用 JSDoc/TSDoc）。
- 禁止：为每一行都写注释、或把实现细节复述一遍的注释。

## 6. 依赖与一致性（强制）

- 不引入项目未使用的新依赖；确需引入时先在方案阶段说明替代方案与影响（体积、维护成本、迁移）。
- 修改必须遵循现有代码风格与模式（命名、目录、数据流、错误处理）。

## 7. 交付与验证（强制）

- 每次执行阶段交付必须包含：
  - 改动摘要、改动文件清单、核心逻辑说明、验证方式（命令 + 手动步骤）、风险与回滚（可选但建议）。
- 至少保证 lint/build 通过（以项目现有脚本为准）。

